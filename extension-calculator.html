<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JKA Architecture - Extension Cost Calculator 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: #FFFFFF;
            padding: 40px 20px;
            color: #191919;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #FFFFFF;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid #19191920;
        }
        
        .header h1 {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
            font-size: 1.5rem;
            color: #191919;
            margin-bottom: 10px;
        }
        
        .header p {
            font-family: 'Poppins', sans-serif;
            font-weight: 300;
            font-size: 1rem;
            color: #191919;
        }
        
        .form-section {
            padding: 30px 0;
            border-bottom: 1px solid #19191915;
        }
        
        .section-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
            font-size: 1.5rem;
            color: #191919;
            margin-bottom: 25px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 300;
            font-size: 1rem;
            color: #191919;
        }
        
        .input-group input[type="number"],
        .input-group input[type="text"],
        .input-group select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #19191930;
            border-radius: 4px;
            font-family: 'Poppins', sans-serif;
            font-weight: 300;
            font-size: 1rem;
            color: #191919;
            background: #FFFFFF;
            transition: all 0.3s;
        }
        
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #191919;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 300;
            font-size: 1rem;
            color: #191919;
        }
        
        .sub-input {
            margin-left: 28px;
            margin-top: 10px;
            margin-bottom: 15px;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .results {
            background: #F9F9F9;
            padding: 30px;
            margin-top: 40px;
            border-radius: 4px;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #19191915;
            font-family: 'Poppins', sans-serif;
            font-weight: 300;
            font-size: 1rem;
        }
        
        .result-row.total {
            font-size: 1.5rem;
            font-weight: 400;
            color: #191919;
            border-bottom: 2px solid #191919;
            margin-top: 15px;
            padding-top: 25px;
        }
        
        .result-row.subtotal {
            font-weight: 400;
            color: #191919;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #19191930;
        }
        
        .result-label {
            color: #191919;
        }
        
        .result-value {
            font-weight: 400;
            color: #191919;
        }
        
        .range-indicator {
            font-family: 'Poppins', sans-serif;
            font-weight: 300;
            font-style: italic;
            font-size: 0.75rem;
            color: #191919;
            opacity: 0.7;
        }
        
        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px 0 20px 0;
        }
        
        .btn {
            padding: 0 30px;
            height: 2rem;
            border: none;
            border-radius: 4px;
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
            font-size: 0.75rem;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
            background: #1919191C;
            color: #191919;
        }
        
        .btn:hover {
            background: #FFFFFF;
            box-shadow: 0 0 0 1px #191919;
        }
        
        .btn-primary {
            background: #191919;
            color: #FFFFFF;
        }
        
        .btn-primary:hover {
            background: #000000;
            box-shadow: none;
        }
        
        .note {
            background: #F9F9F9;
            border-left: 2px solid #191919;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Poppins', sans-serif;
            font-weight: 300;
            font-size: 0.875rem;
            color: #191919;
            line-height: 1.6;
        }
        
        .hint {
            font-family: 'Poppins', sans-serif;
            font-weight: 300;
            font-style: italic;
            font-size: 0.75rem;
            color: #191919;
            margin-top: 4px;
            opacity: 0.7;
        }

        .warning {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
            font-size: 0.75rem;
            color: #D32F2F;
            margin-top: 4px;
        }

        .fee-stage {
            background: #F9F9F9;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        .fee-stage-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 400;
            font-size: 0.875rem;
            color: #191919;
            margin-bottom: 10px;
        }
        
        @media print {
            .button-group {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
        .btn-cta:hover {
            background: #000000 !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(25, 25, 25, 0.25) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Extension Cost Calculator</h1>
            <p>Scotland 2026 | Professional Cost Estimate</p>
        </div>
        
        <div class="form-section">
            <div class="section-title">Client Information</div>
            <div class="grid-2">
                <div class="input-group">
                    <label>Client Name</label>
                    <input type="text" id="clientName" placeholder="Enter client name">
                </div>
                <div class="input-group">
                    <label>Project Address</label>
                    <input type="text" id="projectAddress" placeholder="Enter project address">
                </div>
            </div>
            <div class="input-group">
                <label>Date</label>
                <input type="text" id="date" value="">
            </div>
        </div>
        
        <div class="form-section">
            <div class="section-title">Project Details</div>
            
            <div class="input-group">
                <label>Extension Type</label>
                <select id="extensionType">
                    <option value="single">Single-storey extension</option>
                    <option value="two">Two-storey extension</option>
                </select>
            </div>
            
            <div class="input-group">
                <label>Floor Area (mÂ²)</label>
                <input type="number" id="floorArea" placeholder="e.g., 20" min="1" step="0.1">
            </div>
            
            <div class="input-group">
                <label>Build Cost Range per mÂ²</label>
                <select id="costRange">
                    <option value="low">Low (Single: Â£2,200 | Two-storey: Â£2,000)</option>
                    <option value="mid" selected>Mid (Single: Â£2,700 | Two-storey: Â£2,350)</option>
                    <option value="high">High (Single: Â£3,200 | Two-storey: Â£2,700)</option>
                    <option value="custom">Custom - Enter manually</option>
                </select>
            </div>

            <div class="input-group" id="customCostInput" style="display: none;">
                <div class="grid-2">
                    <div>
                        <label>Single-storey Cost per mÂ² (Â£)</label>
                        <input type="number" id="customSingleCost" placeholder="e.g., 2500" min="0" step="50">
                        <div class="hint" id="singleCostValidation"></div>
                    </div>
                    <div>
                        <label>Two-storey Cost per mÂ² (Â£)</label>
                        <input type="number" id="customTwoStoryCost" placeholder="e.g., 2300" min="0" step="50">
                        <div class="hint" id="twoStoryCostValidation"></div>
                    </div>
                </div>
            </div>
            
            <div class="note">
                <strong>Build cost includes:</strong> foundations, drainage, walls, insulation, roof, standard windows/doors, first-fix electrics & plumbing, plasterboard/plaster, basic finishes.<br>
                <strong>Not included:</strong> kitchens, bathrooms, high-end finishes, landscaping, professional fees, VAT.
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="includeKitchen">
                <label for="includeKitchen">Include Kitchen</label>
            </div>
            <div class="sub-input" id="kitchenCostInput" style="display: none;">
                <label>Kitchen Cost (Â£)</label>
                <input type="number" id="kitchenCostValue" placeholder="Enter cost" min="0" value="6500">
                <div class="hint">Typical range: Â£5,000 - Â£8,000 (avg. Â£6,500)</div>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="includeBathroom">
                <label for="includeBathroom">Include Bathroom</label>
            </div>
            <div class="sub-input" id="bathroomCostInput" style="display: none;">
                <label>Bathroom Cost (Â£)</label>
                <input type="number" id="bathroomCostValue" placeholder="Enter cost" min="0" value="8500">
                <div class="hint">Typical range: Â£7,000 - Â£10,000 (avg. Â£8,500)</div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="includeOpenings">
                <label for="includeOpenings">Structural Openings in Load-Bearing Walls</label>
            </div>
            <div class="sub-input" id="openingsCostInput" style="display: none;">
                <label>Linear Meters of Openings</label>
                <input type="number" id="openingsMeters" placeholder="e.g., 2.4" min="0" step="0.1" value="0">
                <div class="hint">Typical width: single door ~1m, double doors ~1.5-2m, large opening ~3-4m</div>
                
                <label style="margin-top: 10px;">Cost per Linear Meter (Â£)</label>
                <input type="number" id="openingsCostPerMeter" placeholder="3000 - 5000" min="0" value="4000">
                <div class="hint">Typical range: Â£3,000 - Â£5,000/m (avg. Â£4,000)</div>
            </div>
        </div>
        
        <div class="form-section">
            <div class="section-title">Surveys & Site Investigation</div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="ordnanceMaps">
                <label for="ordnanceMaps">Ordnance Survey Maps</label>
            </div>
            <div class="sub-input" id="ordnanceMapsInput" style="display: none;">
                <label>Cost (Â£)</label>
                <input type="number" id="ordnanceMapsCost" placeholder="25 - 75" min="0" value="50">
                <div class="hint">Location and site plans (typical: Â£25-75)</div>
                <div class="checkbox-group" style="margin-left: 0; margin-top: 10px;">
                    <input type="checkbox" id="ordnanceMapsVAT" checked>
                    <label for="ordnanceMapsVAT">VAT Registered (add 20% VAT)</label>
                </div>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="measuredSurvey">
                <label for="measuredSurvey">Measured Survey</label>
            </div>
            <div class="sub-input" id="measuredSurveyInput" style="display: none;">
                <label>Cost (Â£)</label>
                <input type="number" id="measuredSurveyCost" placeholder="300 - 800" min="0" value="500">
                <div class="checkbox-group" style="margin-left: 0; margin-top: 10px;">
                    <input type="checkbox" id="measuredSurveyVAT" checked>
                    <label for="measuredSurveyVAT">VAT Registered (add 20% VAT)</label>
                </div>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="groundSurvey">
                <label for="groundSurvey">Ground Survey</label>
            </div>
            <div class="sub-input" id="groundSurveyInput" style="display: none;">
                <label>Cost (Â£)</label>
                <input type="number" id="groundSurveyCost" placeholder="500 - 1,200" min="0" value="800">
                <div class="checkbox-group" style="margin-left: 0; margin-top: 10px;">
                    <input type="checkbox" id="groundSurveyVAT" checked>
                    <label for="groundSurveyVAT">VAT Registered (add 20% VAT)</label>
                </div>
            </div>
            
        </div>
        
        <div class="form-section">
            <div class="section-title">Professional Fees</div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="includeEngineer">
                <label for="includeEngineer">Structural Engineer</label>
            </div>
            <div class="sub-input" id="engineerFeeInput" style="display: none;">
                <label>Fee (Â£)</label>
                <input type="number" id="engineerFee" placeholder="900 - 2,000" min="0" value="1500">
                <div class="hint">Typical range: Â£900 - Â£2,000</div>
                <div class="checkbox-group" style="margin-left: 0; margin-top: 10px;">
                    <input type="checkbox" id="engineerVAT" checked>
                    <label for="engineerVAT">VAT Registered (add 20% VAT)</label>
                </div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="billOfQuantities">
                <label for="billOfQuantities">Bill of Quantities</label>
            </div>
            <div class="sub-input" id="billOfQuantitiesInput" style="display: none;">
                <label>Cost (Â£)</label>
                <input type="number" id="billOfQuantitiesCost" placeholder="500 - 2,000" min="0" value="1000">
                <div class="hint">Typical range: Â£500 - Â£2,000</div>
                <div class="checkbox-group" style="margin-left: 0; margin-top: 10px;">
                    <input type="checkbox" id="boqVAT" checked>
                    <label for="boqVAT">VAT Registered (add 20% VAT)</label>
                </div>
            </div>
            
            <div class="note">
                <strong>Architect fees by RIBA stage:</strong> Fees can be calculated as percentage of construction cost or as fixed fees for each stage. Total fees across all stages typically sum between 8-15% of construction cost (for listed buildings up to 17% and higher). The smaller project potentially the higher fees and vice versa.
            </div>
            
            <div class="fee-stage">
                <div class="fee-stage-title">Concept Design (RIBA Stage 2)</div>
                <div class="input-group">
                    <label>Calculation Method</label>
                    <select id="conceptFeeMethod">
                        <option value="percentage">Percentage of construction cost</option>
                        <option value="fixed">Fixed fee</option>
                    </select>
                </div>
                <div class="input-group" id="conceptPercentageGroup">
                    <label>Percentage (%)</label>
                    <input type="number" id="conceptPercentage" placeholder="1-2%" min="0" max="100" step="0.1" value="1.5">
                </div>
                <div class="input-group" id="conceptFixedGroup" style="display: none;">
                    <label>Fixed Fee (Â£)</label>
                    <input type="number" id="conceptFixed" placeholder="Enter fixed fee" min="0">
                </div>
                <div class="checkbox-group" style="margin-left: 0; margin-top: 10px;">
                    <input type="checkbox" id="conceptVAT" checked>
                    <label for="conceptVAT">VAT Registered (add 20% VAT)</label>
                </div>
            </div>

            <div class="fee-stage">
                <div class="fee-stage-title">Planning Application (RIBA Stage 3)</div>
                <div class="input-group">
                    <label>Calculation Method</label>
                    <select id="planningDesignFeeMethod">
                        <option value="percentage">Percentage of construction cost</option>
                        <option value="fixed">Fixed fee</option>
                    </select>
                </div>
                <div class="input-group" id="planningDesignPercentageGroup">
                    <label>Percentage (%)</label>
                    <input type="number" id="planningDesignPercentage" placeholder="2-3%" min="0" max="100" step="0.1" value="2.5">
                </div>
                <div class="input-group" id="planningDesignFixedGroup" style="display: none;">
                    <label>Fixed Fee (Â£)</label>
                    <input type="number" id="planningDesignFixed" placeholder="Enter fixed fee" min="0">
                </div>
                <div class="checkbox-group" style="margin-left: 0; margin-top: 10px;">
                    <input type="checkbox" id="planningDesignVAT" checked>
                    <label for="planningDesignVAT">VAT Registered (add 20% VAT)</label>
                </div>
            </div>

            <div class="fee-stage">
                <div class="fee-stage-title">Building Warrant (RIBA Stage 4)</div>
                <div class="input-group">
                    <label>Calculation Method</label>
                    <select id="warrantDesignFeeMethod">
                        <option value="percentage">Percentage of construction cost</option>
                        <option value="fixed">Fixed fee</option>
                    </select>
                </div>
                <div class="input-group" id="warrantDesignPercentageGroup">
                    <label>Percentage (%)</label>
                    <input type="number" id="warrantDesignPercentage" placeholder="3-4%" min="0" max="100" step="0.1" value="3.0">
                </div>
                <div class="input-group" id="warrantDesignFixedGroup" style="display: none;">
                    <label>Fixed Fee (Â£)</label>
                    <input type="number" id="warrantDesignFixed" placeholder="Enter fixed fee" min="0">
                </div>
                <div class="checkbox-group" style="margin-left: 0; margin-top: 10px;">
                    <input type="checkbox" id="warrantDesignVAT" checked>
                    <label for="warrantDesignVAT">VAT Registered (add 20% VAT)</label>
                </div>
            </div>
            
            <div class="fee-stage">
                <div class="fee-stage-title">Tender Support (RIBA Stage 5)</div>
                <div class="input-group">
                    <label>Calculation Method</label>
                    <select id="tenderFeeMethod">
                        <option value="percentage">Percentage of construction cost</option>
                        <option value="fixed">Fixed fee</option>
                    </select>
                </div>
                <div class="input-group" id="tenderPercentageGroup">
                    <label>Percentage (%)</label>
                    <input type="number" id="tenderPercentage" placeholder="1-2%" min="0" max="100" step="0.1" value="1.5">
                </div>
                 <div class="input-group" id="tenderFixedGroup" style="display: none;">
                    <label>Fixed Fee (Â£)</label>
                    <input type="number" id="tenderFixed" placeholder="Enter fixed fee" min="0">
                </div>
                <div class="checkbox-group" style="margin-left: 0; margin-top: 10px;">
                    <input type="checkbox" id="tenderVAT" checked>
                    <label for="tenderVAT">VAT Registered (add 20% VAT)</label>
                </div>
            </div>

            <div class="fee-stage">
    <div class="fee-stage-title">Construction Oversight (RIBA Stage 6)</div>
    <div class="input-group">
        <label>Calculation Method</label>
        <select id="contractAdminFeeMethod">
            <option value="percentage">Percentage of construction cost</option>
            <option value="fixed">Fixed fee</option>
            <option value="hourly">Hourly rate</option>
            <option value="weekly">Weekly rate</option>
        </select>
    </div>
    <div class="input-group" id="contractAdminPercentageGroup">
        <label>Percentage (%)</label>
        <input type="number" id="contractAdminPercentage" placeholder="1-2%" min="0" max="100" step="0.1" value="2.0">
    </div>
    <div class="input-group" id="contractAdminFixedGroup" style="display: none;">
        <label>Fixed Fee (Â£)</label>
        <input type="number" id="contractAdminFixed" placeholder="Enter fixed fee" min="0">
    </div>
    <div id="contractAdminHourlyGroup" style="display: none;">
        <div class="input-group">
            <label>Hourly Rate (Â£)</label>
            <input type="number" id="contractAdminHourlyRate" placeholder="50 - 100" min="0" value="75">
        </div>
        <div class="input-group">
            <label>Estimated Hours</label>
            <input type="number" id="contractAdminHours" placeholder="Enter hours" min="0" value="40">
        </div>
    </div>
    <div id="contractAdminWeeklyGroup" style="display: none;">
        <div class="input-group">
            <label>Weekly Rate (Â£)</label>
            <input type="number" id="contractAdminWeeklyRate" placeholder="300 - 600" min="0" value="450">
        </div>
        <div class="input-group">
            <label>Number of Weeks</label>
            <input type="number" id="contractAdminWeeks" placeholder="Enter weeks" min="0" value="12">
        </div>
    </div>
    <div class="checkbox-group" style="margin-left: 0; margin-top: 10px;">
    <input type="checkbox" id="contractAdminVAT" checked>
    <label for="contractAdminVAT">VAT Registered (add 20% VAT)</label>
    </div>
</div>
        </div>
        
        <div class="form-section">
            <div class="section-title">Statutory Fees</div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="planningRequired">
                <label for="planningRequired">Planning Permission Required</label>
            </div>
            <div class="sub-input" id="planningFeeInput" style="display: none;">
                <label>Planning Fee (Â£)</label>
                <input type="number" id="planningFee" value="357" min="0" readonly>
            <div class="hint">Standard fee for domestic extensions (Edinburgh Council, July 2025). Retrospective applications incur 25% surcharge (Â£446.25).</div>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="warrantRequired">
                <label for="warrantRequired">Building Warrant Required</label>
            </div>
            <div class="sub-input" id="warrantFeeInput" style="display: none;">
                <label>Building Warrant Fee (Â£)</label>
                <input type="number" id="warrantFee" placeholder="Auto-calculated" min="0" readonly>
            <div class="hint">Auto-calculated based on construction cost (Edinburgh Council rates, April 2025). Fees may vary by local authority.</div>
            </div>
        </div>
        
        <div class="form-section">
            <div class="section-title">Contingency</div>
            
           <div class="input-group">
    <label>Contingency Percentage (% of construction cost)</label>
    <select id="contingencyPercent">
        <option value="0">0% (Not recommended)</option>
        <option value="10">10% (Simple projects)</option>
        <option value="12.5">12.5%</option>
        <option value="15" selected>15% (Standard)</option>
        <option value="17.5">17.5%</option>
        <option value="20">20% (Complex projects)</option>
        <option value="25">25% (Very complex/two-storey)</option>
    </select>
</div>

<div class="note">
    Contingency covers unexpected costs during construction (site conditions, specification changes, unforeseen structural work).
</div>

<div class="note" id="contingencyWarning" style="display: none; border-left-color: #D32F2F; background: #FFEBEE;">
    <strong>âš  Warning:</strong> A contingency budget is strongly recommended for renovations and extensions to existing buildings. Unforeseen issues (hidden structural problems, services conflicts, ground conditions) are common and can significantly impact costs. Most professionals recommend a minimum 10-15% contingency.
</div>
        </div>
        
        <div class="results">
            <div class="section-title">Cost Breakdown</div>
    
    <div class="result-row">
        <span class="result-label">Build Cost (ex VAT)</span>
        <span class="result-value" id="buildCost">Â£0</span>
    </div>
    
    <div class="result-row">
        <span class="result-label">Kitchen</span>
        <span class="result-value" id="kitchenCost">Â£0</span>
    </div>
    
    <div class="result-row">
        <span class="result-label">Bathroom</span>
        <span class="result-value" id="bathroomCost">Â£0</span>
    </div>

    <div class="result-row">
        <span class="result-label">Structural Openings <span class="range-indicator" id="openingsDetail"></span></span>
        <span class="result-value" id="openingsCost">Â£0</span>
    </div>
    
    <div class="result-row">
        <span class="result-label">Total Construction Cost (ex VAT)</span>
        <span class="result-value" id="totalConstruction">Â£0</span>
    </div>
    
    <div class="result-row">
        <span class="result-label">Contingency <span class="range-indicator" id="contingencyLabel"></span></span>
        <span class="result-value" id="contingencyCost">Â£0</span>
    </div>
    
    <div class="result-row">
        <span class="result-label">Construction + Contingency (ex VAT)</span>
        <span class="result-value" id="constructionWithContingency">Â£0</span>
    </div>
    
    <div class="result-row">
        <span class="result-label">VAT (20%)</span>
        <span class="result-value" id="vatCost">Â£0</span>
    </div>
    
    <div class="result-row subtotal">
        <span class="result-label">SUBTOTAL: Construction (inc VAT)</span>
        <span class="result-value" id="totalConstructionVAT">Â£0</span>
    </div>
    
    <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #19191920;">
        <div class="result-row">
            <span class="result-label">Ordnance Survey Maps</span>
            <span class="result-value" id="ordnanceMapsDisplay">Â£0</span>
        </div>
        
        <div class="result-row">
            <span class="result-label">Measured Survey</span>
            <span class="result-value" id="measuredSurveyDisplay">Â£0</span>
        </div>
        
        <div class="result-row">
            <span class="result-label">Ground Survey</span>
            <span class="result-value" id="groundSurveyDisplay">Â£0</span>
        </div>
        
        <div class="result-row subtotal">
            <span class="result-label">SUBTOTAL: Surveys & Site Investigation</span>
            <span class="result-value" id="subtotalSurveys">Â£0</span>
        </div>
    </div>
    
    <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #19191920;">
        <div class="result-row">
            <span class="result-label">Bill of Quantities</span>
            <span class="result-value" id="billOfQuantitiesDisplay">Â£0</span>
        </div>
        
        <div class="result-row">
            <span class="result-label">Structural Engineer</span>
            <span class="result-value" id="engineerDisplay">Â£0</span>
        </div>
        
        <div class="result-row">
            <span class="result-label">Architect - Concept Design <span class="range-indicator" id="conceptMethod"></span></span>
            <span class="result-value" id="conceptDisplay">Â£0</span>
        </div>

        <div class="result-row">
            <span class="result-label">Architect - Planning Application <span class="range-indicator" id="planningDesignMethod"></span></span>
            <span class="result-value" id="planningDesignDisplay">Â£0</span>
        </div>

        <div class="result-row">
            <span class="result-label">Architect - Building Warrant <span class="range-indicator" id="warrantDesignMethod"></span></span>
            <span class="result-value" id="warrantDesignDisplay">Â£0</span>
        </div>

        <div class="result-row">
            <span class="result-label">Architect - Tender Support <span class="range-indicator" id="tenderMethod"></span></span>
            <span class="result-value" id="tenderDisplay">Â£0</span>
        </div>

        <div class="result-row">
            <span class="result-label">Architect - Construction Oversight <span class="range-indicator" id="contractAdminMethod"></span></span>
            <span class="result-value" id="contractAdminDisplay">Â£0</span>
        </div>
        
        <div class="result-row subtotal">
            <span class="result-label">SUBTOTAL: Professional Fees</span>
            <span class="result-value" id="subtotalProfessional">Â£0</span>
        </div>
        <div style="font-size: 0.75rem; font-style: italic; color: #191919; opacity: 0.7; padding: 5px 0 0 0;">
            *Professional fees shown include VAT where providers are VAT registered (indicated by checkboxes above)
        </div>
    </div>
    
    <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #19191920;">
        <div class="result-row">
            <span class="result-label">Planning Permission Fee</span>
            <span class="result-value" id="planningDisplay">Â£0</span>
        </div>
        
        <div class="result-row">
            <span class="result-label">Building Warrant Fee</span>
            <span class="result-value" id="warrantDisplay">Â£0</span>
        </div>
        
        <div class="result-row subtotal">
            <span class="result-label">SUBTOTAL: Statutory Fees</span>
            <span class="result-value" id="subtotalStatutory">Â£0</span>
        </div>
    </div>
    
    <div class="result-row total">
        <span class="result-label">TOTAL PROJECT COST (inc VAT)</span>
        <span class="result-value" id="grandTotal">Â£0</span>
        </div>
    </div>
        
        <div class="button-group">
            <a href="https://jkarchitecture.co.uk/#contact" class="btn btn-primary" style="text-decoration: none; display: flex; align-items: center; justify-content: center;">
            Get a Professional Fee Quote for this Project â†’
            </a>
        <button class="btn btn-primary" onclick="generateExcel()" style="display: none;">Download Excel</button>
        <button class="btn btn-primary" onclick="showEmailModal()">ðŸ“„ Get PDF Report</button>
        <button class="btn" onclick="resetForm()">Reset</button>
        </div>
        <!-- Email Capture Modal -->
<div id="emailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;">
    <div style="background: white; padding: 40px; border-radius: 8px; max-width: 500px; width: 90%; position: relative;">
        <button onclick="closeEmailModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
        
        <h2 style="font-family: 'Poppins', sans-serif; font-weight: 400; font-size: 1.5rem; margin-bottom: 10px;">Get Your Professional PDF Report</h2>
        
        <p style="font-family: 'Poppins', sans-serif; font-weight: 300; font-size: 0.875rem; margin-bottom: 25px;">
            Enter your details to receive a comprehensive PDF cost breakdown.
        </p>
        
        <form id="pdfRequestForm" onsubmit="submitEmailForm(event)">
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-family: 'Poppins', sans-serif; font-weight: 300; font-size: 0.875rem;">Name *</label>
                <input type="text" id="userName" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: 'Poppins', sans-serif;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-family: 'Poppins', sans-serif; font-weight: 300; font-size: 0.875rem;">Email *</label>
                <input type="email" id="userEmail" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: 'Poppins', sans-serif;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-family: 'Poppins', sans-serif; font-weight: 300; font-size: 0.875rem;">Phone (optional)</label>
                <input type="tel" id="userPhone" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: 'Poppins', sans-serif;">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: flex; align-items: start; font-family: 'Poppins', sans-serif; font-weight: 300; font-size: 0.75rem;">
                    <input type="checkbox" required style="margin-right: 8px; margin-top: 2px;">
                    <span>I agree to receive the PDF report and occasional project updates from JKA Architecture *</span>
                </label>
            </div>
            
            <button type="submit" id="submitBtn" style="width: 100%; padding: 12px; background: #191919; color: white; border: none; border-radius: 4px; font-family: 'Poppins', sans-serif; font-weight: 400; cursor: pointer;">
                Send Me the PDF Report
            </button>
            
            <div id="formMessage" style="margin-top: 15px; text-align: center; font-family: 'Poppins', sans-serif; font-size: 0.875rem;"></div>
        </form>
        
        <div style="margin-top: 20px; padding: 15px; background: #F9F9F9; border-radius: 4px; font-size: 0.75rem;">
            <strong>What you'll get:</strong><br>
            âœ“ Detailed cost breakdown<br>
            âœ“ Project timeline estimates<br>
            âœ“ Next steps checklist<br>
            âœ“ Follow-up emails with extension tips
        </div>
    </div>
</div>
    </div>
    
    <script>
        // JavaScript will be provided in the next batch
// Set current date
document.getElementById('date').value = new Date().toLocaleDateString('en-GB');

// Toggle visibility for checkboxes
function setupCheckboxToggle(checkboxId, inputId) {
    const checkbox = document.getElementById(checkboxId);
    const input = document.getElementById(inputId);
    
    checkbox.addEventListener('change', function() {
        input.style.display = this.checked ? 'block' : 'none';
        calculate();
    });
}

setupCheckboxToggle('includeKitchen', 'kitchenCostInput');
setupCheckboxToggle('includeBathroom', 'bathroomCostInput');
setupCheckboxToggle('includeOpenings', 'openingsCostInput');
setupCheckboxToggle('ordnanceMaps', 'ordnanceMapsInput');
setupCheckboxToggle('measuredSurvey', 'measuredSurveyInput');
setupCheckboxToggle('groundSurvey', 'groundSurveyInput');
setupCheckboxToggle('includeEngineer', 'engineerFeeInput');
setupCheckboxToggle('billOfQuantities', 'billOfQuantitiesInput');
setupCheckboxToggle('planningRequired', 'planningFeeInput');
setupCheckboxToggle('warrantRequired', 'warrantFeeInput');

// Toggle custom cost input
document.getElementById('costRange').addEventListener('change', function() {
    const customInput = document.getElementById('customCostInput');
    customInput.style.display = this.value === 'custom' ? 'block' : 'none';
    calculate();
});

// Validate custom costs
function validateCustomCost(value, type) {
    const minReasonable = 1500;
    const maxReasonable = 4000;
    const validationElement = document.getElementById(type === 'single' ? 'singleCostValidation' : 'twoStoryCostValidation');
    
    if (!value || value === 0) {
        validationElement.textContent = '';
        validationElement.className = 'hint';
        return;
    }
    
    if (value < minReasonable) {
        validationElement.textContent = `âš  This seems low for Scotland (typical minimum: Â£${minReasonable}/mÂ²)`;
        validationElement.className = 'warning';
    } else if (value > maxReasonable) {
        validationElement.textContent = `âš  This seems high for standard extensions (typical maximum: Â£${maxReasonable}/mÂ²)`;
        validationElement.className = 'warning';
    } else {
        validationElement.textContent = 'âœ“ Within typical range';
        validationElement.className = 'hint';
        validationElement.style.color = '#2E7D32';
    }
}

// Calculate Building Warrant fee based on Edinburgh Council rates (April 2025)
function calculateBuildingWarrantFee(constructionCost) {
    if (constructionCost <= 0) return 0;
    
    // Table 1a: Values up to Â£100,000 (fixed rates)
    if (constructionCost <= 5000) return 210;
    if (constructionCost <= 5500) return 231;
    if (constructionCost <= 6000) return 252;
    if (constructionCost <= 6500) return 273;
    if (constructionCost <= 7000) return 294;
    if (constructionCost <= 7500) return 315;
    if (constructionCost <= 8000) return 336;
    if (constructionCost <= 8500) return 357;
    if (constructionCost <= 9000) return 378;
    if (constructionCost <= 9500) return 399;
    if (constructionCost <= 10000) return 420;
    if (constructionCost <= 11000) return 443;
    if (constructionCost <= 12000) return 466;
    if (constructionCost <= 13000) return 489;
    if (constructionCost <= 14000) return 512;
    if (constructionCost <= 15000) return 535;
    if (constructionCost <= 16000) return 558;
    if (constructionCost <= 17000) return 581;
    if (constructionCost <= 18000) return 604;
    if (constructionCost <= 19000) return 627;
    if (constructionCost <= 20000) return 650;
    if (constructionCost <= 30000) return 728;
    if (constructionCost <= 40000) return 806;
    if (constructionCost <= 50000) return 884;
    if (constructionCost <= 60000) return 962;
    if (constructionCost <= 70000) return 1040;
    if (constructionCost <= 80000) return 1118;
    if (constructionCost <= 90000) return 1196;
    if (constructionCost <= 100000) return 1274;
    
    // Table 1b: Values over Â£100,000
    if (constructionCost <= 120000) return 1402;
    if (constructionCost <= 140000) return 1530;
    if (constructionCost <= 160000) return 1658;
    if (constructionCost <= 180000) return 1786;
    if (constructionCost <= 200000) return 1914;
    if (constructionCost <= 220000) return 2042;
    if (constructionCost <= 240000) return 2170;
    if (constructionCost <= 260000) return 2298;
    if (constructionCost <= 280000) return 2426;
    if (constructionCost <= 300000) return 2554;
    if (constructionCost <= 320000) return 2682;
    if (constructionCost <= 340000) return 2810;
    if (constructionCost <= 360000) return 2938;
    if (constructionCost <= 380000) return 3066;
    if (constructionCost <= 400000) return 3194;
    if (constructionCost <= 420000) return 3322;
    if (constructionCost <= 440000) return 3450;
    if (constructionCost <= 460000) return 3578;
    if (constructionCost <= 480000) return 3706;
    if (constructionCost <= 500000) return 3834;
    if (constructionCost <= 550000) return 4055;
    if (constructionCost <= 600000) return 4276;
    if (constructionCost <= 650000) return 4497;
    if (constructionCost <= 700000) return 4718;
    if (constructionCost <= 750000) return 4939;
    if (constructionCost <= 800000) return 5160;
    if (constructionCost <= 850000) return 5381;
    if (constructionCost <= 900000) return 5602;
    if (constructionCost <= 950000) return 5823;
    if (constructionCost <= 1000000) return 6044;
    
    // Over Â£1 million: Â£6,044 + Â£315 for every Â£100,000 or part thereof
    const baseFee = 6044;
    const excess = constructionCost - 1000000;
    const additionalUnits = Math.ceil(excess / 100000);
    return baseFee + (additionalUnits * 315);
}

document.getElementById('customSingleCost').addEventListener('input', function() {
    validateCustomCost(parseFloat(this.value), 'single');
    calculate();
});

document.getElementById('customTwoStoryCost').addEventListener('input', function() {
    validateCustomCost(parseFloat(this.value), 'two');
    calculate();
});

// Toggle architect fee input methods for each stage
function setupFeeMethodToggle(methodId, percentageGroupId, fixedGroupId, hourlyGroupId, weeklyGroupId) {
    const method = document.getElementById(methodId);
    const percentageGroup = document.getElementById(percentageGroupId);
    const fixedGroup = document.getElementById(fixedGroupId);
    const hourlyGroup = hourlyGroupId ? document.getElementById(hourlyGroupId) : null;
    const weeklyGroup = weeklyGroupId ? document.getElementById(weeklyGroupId) : null;
    
    method.addEventListener('change', function() {
        percentageGroup.style.display = 'none';
        fixedGroup.style.display = 'none';
        if (hourlyGroup) hourlyGroup.style.display = 'none';
        if (weeklyGroup) weeklyGroup.style.display = 'none';
        
        if (this.value === 'percentage') {
            percentageGroup.style.display = 'block';
        } else if (this.value === 'fixed') {
            fixedGroup.style.display = 'block';
        } else if (this.value === 'hourly' && hourlyGroup) {
            hourlyGroup.style.display = 'block';
        } else if (this.value === 'weekly' && weeklyGroup) {
            weeklyGroup.style.display = 'block';
        }
        calculate();
    });
}

setupFeeMethodToggle('conceptFeeMethod', 'conceptPercentageGroup', 'conceptFixedGroup');
setupFeeMethodToggle('planningDesignFeeMethod', 'planningDesignPercentageGroup', 'planningDesignFixedGroup');
setupFeeMethodToggle('warrantDesignFeeMethod', 'warrantDesignPercentageGroup', 'warrantDesignFixedGroup');
setupFeeMethodToggle('tenderFeeMethod', 'tenderPercentageGroup', 'tenderFixedGroup');
setupFeeMethodToggle('contractAdminFeeMethod', 'contractAdminPercentageGroup', 'contractAdminFixedGroup', 'contractAdminHourlyGroup', 'contractAdminWeeklyGroup');

// Add event listeners to all inputs
document.querySelectorAll('input, select').forEach(element => {
    element.addEventListener('input', calculate);
    element.addEventListener('change', calculate);
});

function calculate() {
    const extensionType = document.getElementById('extensionType').value;
    const floorArea = parseFloat(document.getElementById('floorArea').value) || 0;
    const costRange = document.getElementById('costRange').value;

    // Show warning when contingency is set to 0%
document.getElementById('contingencyPercent').addEventListener('change', function() {
    const warningDiv = document.getElementById('contingencyWarning');
    if (this.value === '0') {
        warningDiv.style.display = 'block';
    } else {
        warningDiv.style.display = 'none';
    }
});
    
    // Determine cost per mÂ²
    let costPerSqm = 0;
    
    if (costRange === 'custom') {
        // Use custom values
        if (extensionType === 'single') {
            costPerSqm = parseFloat(document.getElementById('customSingleCost').value) || 0;
        } else {
            costPerSqm = parseFloat(document.getElementById('customTwoStoryCost').value) || 0;
        }
    } else {
        // Use preset ranges
        if (extensionType === 'single') {
            costPerSqm = costRange === 'low' ? 2200 : costRange === 'mid' ? 2700 : 3200;
        } else {
            costPerSqm = costRange === 'low' ? 2000 : costRange === 'mid' ? 2350 : 2700;
        }
    }
    
    // Calculate build cost
    const buildCost = floorArea * costPerSqm;
    
    // Kitchen and bathroom
    const includeKitchen = document.getElementById('includeKitchen').checked;
    const includeBathroom = document.getElementById('includeBathroom').checked;
    
    const kitchenCost = includeKitchen ? (parseFloat(document.getElementById('kitchenCostValue').value) || 0) : 0;
    const bathroomCost = includeBathroom ? (parseFloat(document.getElementById('bathroomCostValue').value) || 0) : 0;
    
    // Structural openings
    const includeOpenings = document.getElementById('includeOpenings').checked;
    let openingsCost = 0;
    let openingsMeters = 0;
    if (includeOpenings) {
        openingsMeters = parseFloat(document.getElementById('openingsMeters').value) || 0;
        const costPerMeter = parseFloat(document.getElementById('openingsCostPerMeter').value) || 0;
        openingsCost = openingsMeters * costPerMeter;
    }
    
    // Total construction cost
    const totalConstruction = buildCost + kitchenCost + bathroomCost + openingsCost;
    
    // Contingency (on construction cost only)
    const contingencyPercent = parseFloat(document.getElementById('contingencyPercent').value);
    const contingencyCost = totalConstruction * (contingencyPercent / 100);
    
    // Construction with contingency
    const constructionWithContingency = totalConstruction + contingencyCost;
    
    // VAT
    const vatCost = constructionWithContingency * 0.20;
    const totalConstructionVAT = constructionWithContingency + vatCost;
    
    // Survey fees with VAT
const ordnanceMapsBase = document.getElementById('ordnanceMaps').checked ? 
    (parseFloat(document.getElementById('ordnanceMapsCost').value) || 0) : 0;
const ordnanceMapsVAT = document.getElementById('ordnanceMapsVAT').checked ? ordnanceMapsBase * 0.20 : 0;
const ordnanceMaps = ordnanceMapsBase + ordnanceMapsVAT;

const measuredSurveyBase = document.getElementById('measuredSurvey').checked ? 
    (parseFloat(document.getElementById('measuredSurveyCost').value) || 0) : 0;
const measuredSurveyVAT = document.getElementById('measuredSurveyVAT').checked ? measuredSurveyBase * 0.20 : 0;
const measuredSurvey = measuredSurveyBase + measuredSurveyVAT;

const groundSurveyBase = document.getElementById('groundSurvey').checked ? 
    (parseFloat(document.getElementById('groundSurveyCost').value) || 0) : 0;
const groundSurveyVAT = document.getElementById('groundSurveyVAT').checked ? groundSurveyBase * 0.20 : 0;
const groundSurvey = groundSurveyBase + groundSurveyVAT;

const billOfQuantitiesBase = document.getElementById('billOfQuantities').checked ? 
    (parseFloat(document.getElementById('billOfQuantitiesCost').value) || 0) : 0;
const billOfQuantitiesVAT = document.getElementById('boqVAT').checked ? billOfQuantitiesBase * 0.20 : 0;
const billOfQuantities = billOfQuantitiesBase + billOfQuantitiesVAT;

const engineerFeeBase = document.getElementById('includeEngineer').checked ?
    (parseFloat(document.getElementById('engineerFee').value) || 0) : 0;
const engineerFeeVAT = document.getElementById('engineerVAT').checked ? engineerFeeBase * 0.20 : 0;
const engineerFee = engineerFeeBase + engineerFeeVAT;

// Architect fees by stage with VAT
let conceptFeeBase = 0;
const conceptMethod = document.getElementById('conceptFeeMethod').value;
if (conceptMethod === 'percentage') {
    const conceptPercent = parseFloat(document.getElementById('conceptPercentage').value) || 0;
    conceptFeeBase = totalConstruction * (conceptPercent / 100);
    document.getElementById('conceptMethod').textContent = `(${conceptPercent}%)`;
} else {
    conceptFeeBase = parseFloat(document.getElementById('conceptFixed').value) || 0;
    document.getElementById('conceptMethod').textContent = '(fixed)';
}
const conceptFeeVAT = document.getElementById('conceptVAT').checked ? conceptFeeBase * 0.20 : 0;
const conceptFee = conceptFeeBase + conceptFeeVAT;

let planningDesignFeeBase = 0;
const planningDesignMethod = document.getElementById('planningDesignFeeMethod').value;
if (planningDesignMethod === 'percentage') {
    const planningDesignPercent = parseFloat(document.getElementById('planningDesignPercentage').value) || 0;
    planningDesignFeeBase = totalConstruction * (planningDesignPercent / 100);
    document.getElementById('planningDesignMethod').textContent = `(${planningDesignPercent}%)`;
} else {
    planningDesignFeeBase = parseFloat(document.getElementById('planningDesignFixed').value) || 0;
    document.getElementById('planningDesignMethod').textContent = '(fixed)';
}
const planningDesignFeeVAT = document.getElementById('planningDesignVAT').checked ? planningDesignFeeBase * 0.20 : 0;
const planningDesignFee = planningDesignFeeBase + planningDesignFeeVAT;

let warrantDesignFeeBase = 0;
const warrantDesignMethod = document.getElementById('warrantDesignFeeMethod').value;
if (warrantDesignMethod === 'percentage') {
    const warrantDesignPercent = parseFloat(document.getElementById('warrantDesignPercentage').value) || 0;
    warrantDesignFeeBase = totalConstruction * (warrantDesignPercent / 100);
    document.getElementById('warrantDesignMethod').textContent = `(${warrantDesignPercent}%)`;
} else {
    warrantDesignFeeBase = parseFloat(document.getElementById('warrantDesignFixed').value) || 0;
    document.getElementById('warrantDesignMethod').textContent = '(fixed)';
}
const warrantDesignFeeVAT = document.getElementById('warrantDesignVAT').checked ? warrantDesignFeeBase * 0.20 : 0;
const warrantDesignFee = warrantDesignFeeBase + warrantDesignFeeVAT;

// Tender stage with VAT
let tenderFeeBase = 0;
const tenderMethod = document.getElementById('tenderFeeMethod').value;
if (tenderMethod === 'percentage') {
    const tenderPercent = parseFloat(document.getElementById('tenderPercentage').value) || 0;
    tenderFeeBase = totalConstruction * (tenderPercent / 100);
    document.getElementById('tenderMethod').textContent = `(${tenderPercent}%)`;
} else {
    tenderFeeBase = parseFloat(document.getElementById('tenderFixed').value) || 0;
    document.getElementById('tenderMethod').textContent = '(fixed)';
}
const tenderFeeVAT = document.getElementById('tenderVAT').checked ? tenderFeeBase * 0.20 : 0;
const tenderFee = tenderFeeBase + tenderFeeVAT;

// Contract Admin stage with VAT
let contractAdminFeeBase = 0;
const contractAdminMethod = document.getElementById('contractAdminFeeMethod').value;
if (contractAdminMethod === 'percentage') {
    const contractAdminPercent = parseFloat(document.getElementById('contractAdminPercentage').value) || 0;
    contractAdminFeeBase = totalConstruction * (contractAdminPercent / 100);
    document.getElementById('contractAdminMethod').textContent = `(${contractAdminPercent}%)`;
} else if (contractAdminMethod === 'fixed') {
    contractAdminFeeBase = parseFloat(document.getElementById('contractAdminFixed').value) || 0;
    document.getElementById('contractAdminMethod').textContent = '(fixed)';
} else if (contractAdminMethod === 'hourly') {
    const hourlyRate = parseFloat(document.getElementById('contractAdminHourlyRate').value) || 0;
    const hours = parseFloat(document.getElementById('contractAdminHours').value) || 0;
    contractAdminFeeBase = hourlyRate * hours;
    document.getElementById('contractAdminMethod').textContent = `(Â£${hourlyRate}/hr Ã— ${hours}hrs)`;
} else if (contractAdminMethod === 'weekly') {
    const weeklyRate = parseFloat(document.getElementById('contractAdminWeeklyRate').value) || 0;
    const weeks = parseFloat(document.getElementById('contractAdminWeeks').value) || 0;
    contractAdminFeeBase = weeklyRate * weeks;
    document.getElementById('contractAdminMethod').textContent = `(Â£${weeklyRate}/wk Ã— ${weeks}wks)`;
}
const contractAdminFeeVAT = document.getElementById('contractAdminVAT').checked ? contractAdminFeeBase * 0.20 : 0;
const contractAdminFee = contractAdminFeeBase + contractAdminFeeVAT;
    
    // Statutory fees
    // Planning Permission fee - fixed at Â£357 for domestic extensions
let planningFee = 0;
if (document.getElementById('planningRequired').checked) {
    planningFee = 357;
    document.getElementById('planningFee').value = 357;
} else {
    document.getElementById('planningFee').value = '';
}
    
    // Auto-calculate Building Warrant fee when checkbox is checked
let warrantFee = 0;
if (document.getElementById('warrantRequired').checked) {
    const autoCalculatedFee = calculateBuildingWarrantFee(totalConstruction);
    document.getElementById('warrantFee').value = autoCalculatedFee;
    warrantFee = autoCalculatedFee;
} else {
    document.getElementById('warrantFee').value = '';
}
    
    // Calculate subtotals
    const subtotalSurveys = ordnanceMaps + measuredSurvey + groundSurvey;
    const subtotalProfessional = billOfQuantities + engineerFee + conceptFee + planningDesignFee + warrantDesignFee + tenderFee + contractAdminFee;
    const subtotalStatutory = planningFee + warrantFee;

    const totalFees = subtotalSurveys + subtotalProfessional + subtotalStatutory;

    // Grand total
    const grandTotal = totalConstructionVAT + totalFees;

      
    // Update display
    document.getElementById('buildCost').textContent = formatCurrency(buildCost);
    document.getElementById('kitchenCost').textContent = formatCurrency(kitchenCost);
    document.getElementById('bathroomCost').textContent = formatCurrency(bathroomCost);
    document.getElementById('openingsCost').textContent = formatCurrency(openingsCost);
    document.getElementById('openingsDetail').textContent = includeOpenings && openingsMeters > 0 ? `(${openingsMeters}m)` : '';
    
    document.getElementById('totalConstruction').textContent = formatCurrency(totalConstruction);
    document.getElementById('contingencyCost').textContent = formatCurrency(contingencyCost);
    document.getElementById('contingencyLabel').textContent = `(${contingencyPercent}%)`;
    document.getElementById('constructionWithContingency').textContent = formatCurrency(constructionWithContingency);
    document.getElementById('vatCost').textContent = formatCurrency(vatCost);
    document.getElementById('totalConstructionVAT').textContent = formatCurrency(totalConstructionVAT);
    document.getElementById('subtotalSurveys').textContent = formatCurrency(subtotalSurveys);
    document.getElementById('subtotalProfessional').textContent = formatCurrency(subtotalProfessional);
    document.getElementById('subtotalStatutory').textContent = formatCurrency(subtotalStatutory);
    
    document.getElementById('ordnanceMapsDisplay').textContent = formatCurrency(ordnanceMaps);
    document.getElementById('measuredSurveyDisplay').textContent = formatCurrency(measuredSurvey);
    document.getElementById('groundSurveyDisplay').textContent = formatCurrency(groundSurvey);
    document.getElementById('billOfQuantitiesDisplay').textContent = formatCurrency(billOfQuantities);
    document.getElementById('engineerDisplay').textContent = formatCurrency(engineerFee);
    document.getElementById('conceptDisplay').textContent = formatCurrency(conceptFee);
    document.getElementById('planningDesignDisplay').textContent = formatCurrency(planningDesignFee);
    document.getElementById('warrantDesignDisplay').textContent = formatCurrency(warrantDesignFee);
    document.getElementById('tenderDisplay').textContent = formatCurrency(tenderFee);
    document.getElementById('contractAdminDisplay').textContent = formatCurrency(contractAdminFee);
    document.getElementById('planningDisplay').textContent = formatCurrency(planningFee);
    document.getElementById('warrantDisplay').textContent = formatCurrency(warrantFee);

    document.getElementById('subtotalSurveys').textContent = formatCurrency(subtotalSurveys);
    document.getElementById('subtotalProfessional').textContent = formatCurrency(subtotalProfessional);
    document.getElementById('subtotalStatutory').textContent = formatCurrency(subtotalStatutory);

    document.getElementById('grandTotal').textContent = formatCurrency(grandTotal);
    }

    function formatCurrency(value) {
    return 'Â£' + Math.round(value).toLocaleString('en-GB');
    }

function generateExcel() {
    const data = collectData();
    
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet([
        ['JKA ARCHITECTURE - EXTENSION COST ESTIMATE'],
        ['Scotland 2026'],
        [''],
        ['CLIENT INFORMATION'],
        ['Client Name:', data.clientName],
        ['Project Address:', data.projectAddress],
        ['Date:', data.date],
        [''],
        ['PROJECT DETAILS'],
        ['Extension Type:', data.extensionType],
        ['Floor Area (mÂ²):', data.floorArea],
        ['Cost per mÂ²:', 'Â£' + data.costPerSqm],
        [''],
        ['COST BREAKDOWN'],
        ['Build Cost (ex VAT):', 'Â£' + data.buildCost.toLocaleString()],
        ['Kitchen:', 'Â£' + data.kitchenCost.toLocaleString()],
        ['Bathroom:', 'Â£' + data.bathroomCost.toLocaleString()],
        ['Structural Openings (' + data.openingsMeters + 'm):', 'Â£' + data.openingsCost.toLocaleString()],
        ['Total Construction (ex VAT):', 'Â£' + data.totalConstruction.toLocaleString()],
        [''],
        ['Contingency (' + data.contingencyPercent + '%):', 'Â£' + data.contingencyCost.toLocaleString()],
        ['Construction + Contingency (ex VAT):', 'Â£' + data.constructionWithContingency.toLocaleString()],
        ['VAT (20%):', 'Â£' + data.vatCost.toLocaleString()],
        ['Total Construction (inc VAT):', 'Â£' + data.totalConstructionVAT.toLocaleString()],
        [''],
        ['PROFESSIONAL & STATUTORY FEES'],
        ['Ordnance Survey Maps:', 'Â£' + data.ordnanceMaps.toLocaleString()],
        ['Measured Survey:', 'Â£' + data.measuredSurvey.toLocaleString()],
        ['Ground Survey:', 'Â£' + data.groundSurvey.toLocaleString()],
        ['Bill of Quantities:', 'Â£' + data.billOfQuantities.toLocaleString()],
        ['Structural Engineer:', 'Â£' + data.engineerFee.toLocaleString()],
        ['Architect - Concept Design:', 'Â£' + data.conceptFee.toLocaleString()],
        ['Architect - Planning Application:', 'Â£' + data.planningDesignFee.toLocaleString()],
        ['Architect - Building Warrant:', 'Â£' + data.warrantDesignFee.toLocaleString()],
        ['Architect - Tender Support:', 'Â£' + data.tenderFee.toLocaleString()],
        ['Architect - Construction Oversight    :', 'Â£' + data.contractAdminFee.toLocaleString()],
        ['Planning Permission Fee:', 'Â£' + data.planningFee.toLocaleString()],
        ['Building Warrant Fee:', 'Â£' + data.warrantFee.toLocaleString()],
        ['Total Fees:', 'Â£' + data.totalFees.toLocaleString()],
        [''],
        ['TOTAL PROJECT COST (inc VAT):', 'Â£' + data.grandTotal.toLocaleString()],
        [''],
        [''],
        ['Notes:'],
        ['Build cost includes: foundations, drainage, walls, insulation, roof, standard windows/doors,'],
        ['first-fix electrics & plumbing, plasterboard/plaster, basic finishes.'],
        [''],
        ['Not included: kitchens, bathrooms, high-end finishes, landscaping beyond basics.'],
        [''],
        ['Kitchen range: Â£5,000 - Â£8,000 (avg. Â£6,500)'],
        ['Bathroom range: Â£7,000 - Â£10,000 (avg. Â£8,500)'],
        ['Structural openings: Â£3,000 - Â£5,000 per linear meter (avg. Â£4,000)'],
        ['Ordnance Survey Maps: Â£25 - Â£75'],
        ['Bill of Quantities range: Â£500 - Â£2,000'],
        [''],
        ['Architect fees by RIBA stage (total across all stages typically ~10% of construction cost):'],
        ['- Concept Design (Stage 2): typically 2.0% of construction cost'],
        ['- Planning Application (Stage 3): typically 2.5% of construction cost'],
        ['- Building Warrant (Stage 4): typically 2.5% of construction cost'],
        ['- Tender Support (Stage 5): typically 1.0% of construction cost'],
        ['- Contract Administration (Stage 6): typically 2.0% or hourly/weekly rate'],
        [''],
        ['This estimate is indicative and based on typical market rates for Scotland in 2026.'],
        ['Final costs depend on specification, site conditions, and contractor pricing.']
    ]);
    
    ws['!cols'] = [{ wch: 40 }, { wch: 20 }];
    
    XLSX.utils.book_append_sheet(wb, ws, 'Cost Estimate');
    
    const filename = `JKA_Extension_Cost_Estimate_${data.clientName.replace(/\s+/g, '_') || 'Client'}_${new Date().toISOString().split('T')[0]}.xlsx`;
    XLSX.writeFile(wb, filename);
}

function collectData() {
    const extensionType = document.getElementById('extensionType').value;
    const floorArea = parseFloat(document.getElementById('floorArea').value) || 0;
    const costRange = document.getElementById('costRange').value;
    
    let costPerSqm = 0;
    if (costRange === 'custom') {
        if (extensionType === 'single') {
            costPerSqm = parseFloat(document.getElementById('customSingleCost').value) || 0;
        } else {
            costPerSqm = parseFloat(document.getElementById('customTwoStoryCost').value) || 0;
        }
    } else {
        if (extensionType === 'single') {
            costPerSqm = costRange === 'low' ? 2200 : costRange === 'mid' ? 2700 : 3200;
        } else {
            costPerSqm = costRange === 'low' ? 2000 : costRange === 'mid' ? 2350 : 2700;
        }
    }
    
    const buildCost = Math.round(floorArea * costPerSqm);
    const kitchenCost = document.getElementById('includeKitchen').checked ? 
        Math.round(parseFloat(document.getElementById('kitchenCostValue').value) || 0) : 0;
    const bathroomCost = document.getElementById('includeBathroom').checked ? 
        Math.round(parseFloat(document.getElementById('bathroomCostValue').value) || 0) : 0;
    
    let openingsCost = 0;
    let openingsMeters = 0;
    if (document.getElementById('includeOpenings').checked) {
        openingsMeters = parseFloat(document.getElementById('openingsMeters').value) || 0;
        const costPerMeter = parseFloat(document.getElementById('openingsCostPerMeter').value) || 0;
        openingsCost = Math.round(openingsMeters * costPerMeter);
    }
    
    const totalConstruction = buildCost + kitchenCost + bathroomCost + openingsCost;
    
    const contingencyPercent = parseFloat(document.getElementById('contingencyPercent').value);
    const contingencyCost = Math.round(totalConstruction * (contingencyPercent / 100));
    const constructionWithContingency = totalConstruction + contingencyCost;
    const vatCost = Math.round(constructionWithContingency * 0.20);
    const totalConstructionVAT = constructionWithContingency + vatCost;
    
    const ordnanceMaps = document.getElementById('ordnanceMaps').checked ? 
        Math.round(parseFloat(document.getElementById('ordnanceMapsCost').value) || 0) : 0;
    const measuredSurvey = document.getElementById('measuredSurvey').checked ? 
        Math.round(parseFloat(document.getElementById('measuredSurveyCost').value) || 0) : 0;
    const groundSurvey = document.getElementById('groundSurvey').checked ? 
        Math.round(parseFloat(document.getElementById('groundSurveyCost').value) || 0) : 0;
    const billOfQuantities = document.getElementById('billOfQuantities').checked ? 
        Math.round(parseFloat(document.getElementById('billOfQuantitiesCost').value) || 0) : 0;
    const engineerFee = document.getElementById('includeEngineer').checked ?
        Math.round(parseFloat(document.getElementById('engineerFee').value) || 0) : 0;
    
    let conceptFee = 0;
    if (document.getElementById('conceptFeeMethod').value === 'percentage') {
        const percent = parseFloat(document.getElementById('conceptPercentage').value) || 0;
        conceptFee = Math.round(totalConstruction * (percent / 100));
    } else {
        conceptFee = Math.round(parseFloat(document.getElementById('conceptFixed').value) || 0);
    }
    
    let planningDesignFee = 0;
    if (document.getElementById('planningDesignFeeMethod').value === 'percentage') {
        const percent = parseFloat(document.getElementById('planningDesignPercentage').value) || 0;
        planningDesignFee = Math.round(totalConstruction * (percent / 100));
    } else {
        planningDesignFee = Math.round(parseFloat(document.getElementById('planningDesignFixed').value) || 0);
    }
    
    let warrantDesignFee = 0;
    if (document.getElementById('warrantDesignFeeMethod').value === 'percentage') {
        const percent = parseFloat(document.getElementById('warrantDesignPercentage').value) || 0;
        warrantDesignFee = Math.round(totalConstruction * (percent / 100));
    } else {
        warrantDesignFee = Math.round(parseFloat(document.getElementById('warrantDesignFixed').value) || 0);
    }
    
    let tenderFee = 0;
    if (document.getElementById('includeTender').checked) {
        if (document.getElementById('tenderFeeMethod').value === 'percentage') {
            const percent = parseFloat(document.getElementById('tenderPercentage').value) || 0;
            tenderFee = Math.round(totalConstruction * (percent / 100));
        } else {
            tenderFee = Math.round(parseFloat(document.getElementById('tenderFixed').value) || 0);
        }
    }
    
    let contractAdminFee = 0;
    if (document.getElementById('includeContractAdmin').checked) {
        const method = document.getElementById('contractAdminFeeMethod').value;
        if (method === 'percentage') {
            const percent = parseFloat(document.getElementById('contractAdminPercentage').value) || 0;
            contractAdminFee = Math.round(totalConstruction * (percent / 100));
        } else if (method === 'fixed') {
            contractAdminFee = Math.round(parseFloat(document.getElementById('contractAdminFixed').value) || 0);
        } else if (method === 'hourly') {
            const rate = parseFloat(document.getElementById('contractAdminHourlyRate').value) || 0;
            const hours = parseFloat(document.getElementById('contractAdminHours').value) || 0;
            contractAdminFee = Math.round(rate * hours);
        } else if (method === 'weekly') {
            const rate = parseFloat(document.getElementById('contractAdminWeeklyRate').value) || 0;
            const weeks = parseFloat(document.getElementById('contractAdminWeeks').value) || 0;
            contractAdminFee = Math.round(rate * weeks);
        }
    }
    
    const planningFee = document.getElementById('planningRequired').checked ? 
        Math.round(parseFloat(document.getElementById('planningFee').value) || 0) : 0;
    const warrantFee = document.getElementById('warrantRequired').checked ? 
        Math.round(parseFloat(document.getElementById('warrantFee').value) || 0) : 0;
    
    // Calculate subtotals
    const subtotalSurveys = ordnanceMaps + measuredSurvey + groundSurvey;
    const subtotalProfessional = billOfQuantities + engineerFee + conceptFee + planningDesignFee + warrantDesignFee + tenderFee + contractAdminFee;
    const subtotalStatutory = planningFee + warrantFee;

    const totalFees = subtotalSurveys + subtotalProfessional + subtotalStatutory;

    // Grand total
    const grandTotal = totalConstructionVAT + totalFees;
    
    return {
        clientName: document.getElementById('clientName').value || 'Not specified',
        projectAddress: document.getElementById('projectAddress').value || 'Not specified',
        date: document.getElementById('date').value,
        extensionType: extensionType === 'single' ? 'Single-storey' : 'Two-storey',
        floorArea: floorArea,
        costPerSqm: costPerSqm,
        buildCost: buildCost,
        kitchenCost: kitchenCost,
        bathroomCost: bathroomCost,
        openingsCost: openingsCost,
        openingsMeters: openingsMeters,
        totalConstruction: totalConstruction,
        contingencyPercent: contingencyPercent,
        contingencyCost: contingencyCost,
        constructionWithContingency: constructionWithContingency,
        vatCost: vatCost,
        totalConstructionVAT: totalConstructionVAT,
        ordnanceMaps: ordnanceMaps,
        measuredSurvey: measuredSurvey,
        groundSurvey: groundSurvey,
        billOfQuantities: billOfQuantities,
        engineerFee: engineerFee,
        conceptFee: conceptFee,
        planningDesignFee: planningDesignFee,
        warrantDesignFee: warrantDesignFee,
        tenderFee: tenderFee,
        contractAdminFee: contractAdminFee,
        planningFee: planningFee,
        warrantFee: warrantFee,
        totalFees: totalFees,
        grandTotal: grandTotal
    };
}

function resetForm() {
    if (confirm('Are you sure you want to reset all values?')) {
        document.getElementById('clientName').value = '';
        document.getElementById('projectAddress').value = '';
        document.getElementById('date').value = new Date().toLocaleDateString('en-GB');
        document.getElementById('extensionType').value = 'single';
        document.getElementById('floorArea').value = '';
        document.getElementById('costRange').value = 'mid';
        document.getElementById('customCostInput').style.display = 'none';
        document.getElementById('customSingleCost').value = '';
        document.getElementById('customTwoStoryCost').value = '';
        document.getElementById('singleCostValidation').textContent = '';
        document.getElementById('twoStoryCostValidation').textContent = '';
        
        document.getElementById('includeKitchen').checked = false;
        document.getElementById('includeBathroom').checked = false;
        document.getElementById('kitchenCostValue').value = '6500';
        document.getElementById('bathroomCostValue').value = '8500';
        document.getElementById('kitchenCostInput').style.display = 'none';
        document.getElementById('bathroomCostInput').style.display = 'none';
        document.getElementById('includeOpenings').checked = false;
        document.getElementById('openingsMeters').value = '0';
        document.getElementById('openingsCostPerMeter').value = '4000';
        document.getElementById('openingsCostInput').style.display = 'none';
        
        document.getElementById('ordnanceMaps').checked = false;
        document.getElementById('measuredSurvey').checked = false;
        document.getElementById('groundSurvey').checked = false;
        document.getElementById('billOfQuantities').checked = false;
        document.getElementById('includeEngineer').checked = false;
        document.getElementById('ordnanceMapsInput').style.display = 'none';
        document.getElementById('measuredSurveyInput').style.display = 'none';
        document.getElementById('groundSurveyInput').style.display = 'none';
        document.getElementById('billOfQuantitiesInput').style.display = 'none';
        document.getElementById('engineerFeeInput').style.display = 'none';
        document.getElementById('ordnanceMapsCost').value = '50';
        document.getElementById('measuredSurveyCost').value = '500';
        document.getElementById('groundSurveyCost').value = '800';
        document.getElementById('billOfQuantitiesCost').value = '1000';
        document.getElementById('engineerFee').value = '1500';
        
        document.getElementById('conceptFeeMethod').value = 'percentage';
        document.getElementById('conceptPercentage').value = '2.5';
        document.getElementById('conceptFixed').value = '';
        document.getElementById('conceptPercentageGroup').style.display = 'block';
        document.getElementById('conceptFixedGroup').style.display = 'none';
        
        document.getElementById('planningDesignFeeMethod').value = 'percentage';
        document.getElementById('planningDesignPercentage').value = '3.5';
        document.getElementById('planningDesignFixed').value = '';
        document.getElementById('planningDesignPercentageGroup').style.display = 'block';
        document.getElementById('planningDesignFixedGroup').style.display = 'none';
        
        document.getElementById('warrantDesignFeeMethod').value = 'percentage';
        document.getElementById('warrantDesignPercentage').value = '4.0';
        document.getElementById('warrantDesignFixed').value = '';
        document.getElementById('warrantDesignPercentageGroup').style.display = 'block';
        document.getElementById('warrantDesignFixedGroup').style.display = 'none';
        
        document.getElementById('tenderFeeMethod').value = 'percentage';
        document.getElementById('tenderPercentage').value = '1.5';
        document.getElementById('tenderFixed').value = '';
        document.getElementById('tenderPercentageGroup').style.display = 'block';
        document.getElementById('tenderFixedGroup').style.display = 'none';
        
        document.getElementById('contractAdminFeeMethod').value = 'percentage';
        document.getElementById('contractAdminPercentage').value = '2.0';
        document.getElementById('contractAdminFixed').value = '';
        document.getElementById('contractAdminHourlyRate').value = '75';
        document.getElementById('contractAdminHours').value = '40';
        document.getElementById('contractAdminWeeklyRate').value = '450';
        document.getElementById('contractAdminWeeks').value = '12';
        document.getElementById('contractAdminPercentageGroup').style.display = 'block';
        document.getElementById('contractAdminFixedGroup').style.display = 'none';
        document.getElementById('contractAdminHourlyGroup').style.display = 'none';
        document.getElementById('contractAdminWeeklyGroup').style.display = 'none';
        
        document.getElementById('planningRequired').checked = false;
        document.getElementById('warrantRequired').checked = false;
        document.getElementById('planningFeeInput').style.display = 'none';
        document.getElementById('warrantFeeInput').style.display = 'none';
        document.getElementById('planningFee').value = '';
        document.getElementById('warrantFee').value = '';
        
        document.getElementById('contingencyPercent').value = '15';
        
        calculate();
    }
}

// Initial calculation
calculate();
// Google Apps Script Web App URL - UPDATE THIS!
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyoWQHAY9hAugX1DO91XhbwIgBjlFKQkx8ZXIQ-6W4jzt4W6N46tH3xHd9ko73tY4zPfA/exec';

function showEmailModal() {
    document.getElementById('emailModal').style.display = 'flex';
}

function closeEmailModal() {
    document.getElementById('emailModal').style.display = 'none';
    document.getElementById('pdfRequestForm').reset();
    document.getElementById('formMessage').innerHTML = '';
}

function submitEmailForm(event) {
    event.preventDefault();
    
    const submitBtn = document.getElementById('submitBtn');
    const formMessage = document.getElementById('formMessage');
    
    // Disable button
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';
    
    // Collect ALL calculator data
    const calcData = collectData();
    
    // Prepare complete data package for Google Apps Script
    const formData = {
        name: document.getElementById('userName').value,
        email: document.getElementById('userEmail').value,
        phone: document.getElementById('userPhone').value || '',
        address: document.getElementById('projectAddress').value || '',
        extensionType: calcData.extensionType,
        floorArea: calcData.floorArea,
        totalCost: calcData.grandTotal,
        costBreakdown: {
            // Construction
            buildCost: calcData.buildCost,
            kitchenCost: calcData.kitchenCost,
            bathroomCost: calcData.bathroomCost,
            openingsCost: calcData.openingsCost,
            totalConstruction: calcData.totalConstruction,
            contingency: calcData.contingencyCost,
            constructionWithContingency: calcData.constructionWithContingency,
            vat: calcData.vatCost,
            constructionTotal: calcData.totalConstructionVAT,
            
            // Surveys
            ordnanceMaps: calcData.ordnanceMaps,
            measuredSurvey: calcData.measuredSurvey,
            groundSurvey: calcData.groundSurvey,
            surveysTotal: calcData.ordnanceMaps + calcData.measuredSurvey + calcData.groundSurvey,
            
            // Professional Fees
            billOfQuantities: calcData.billOfQuantities,
            engineerFee: calcData.engineerFee,
            conceptFee: calcData.conceptFee,
            planningFee: calcData.planningDesignFee,
            warrantFee: calcData.warrantDesignFee,
            tenderFee: calcData.tenderFee,
            constructionFee: calcData.contractAdminFee,
            professionalFees: calcData.totalFees - (calcData.planningFee + calcData.warrantFee) - (calcData.ordnanceMaps + calcData.measuredSurvey + calcData.groundSurvey),
            
            // Statutory Fees
            planningPermissionFee: calcData.planningFee,
            buildingWarrantFee: calcData.warrantFee,
            statutoryFees: calcData.planningFee + calcData.warrantFee,
            
            // Summary
            totalFees: calcData.totalFees
        }
    };
    
    // Send to Google Apps Script
    fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
    })
    .then(() => {
        formMessage.innerHTML = '<div style="color: green; background: #e8f5e9; padding: 10px; border-radius: 4px;">âœ“ Success! Check your email - your PDF is on its way (arrives within 60 seconds).</div>';
        submitBtn.textContent = 'Sent!';
        
        setTimeout(() => {
            closeEmailModal();
            submitBtn.disabled = false;
            submitBtn.textContent = 'Send Me the PDF Report';
        }, 3000);
    })
    .catch((error) => {
        formMessage.innerHTML = '<div style="color: red; background: #ffebee; padding: 10px; border-radius: 4px;">âš  Error sending. Please try again or email us directly.</div>';
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Me the PDF Report';
    });
}

// Close modal when clicking outside
document.getElementById('emailModal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeEmailModal();
    }
});
    </script>
</body>
</html>
